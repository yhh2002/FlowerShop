<h2 class="ui header">âš™ï¸ ç®¡ç†è€…å¾Œå°</h2>
<div class="ui divider"></div>

<div class="ui vertical menu">
  <a class="item" (click)="selectedSection = 'products'">ğŸ“¦ ç”¢å“ç®¡ç†</a>
  <a class="item" (click)="selectedSection = 'orders'">ğŸ“œ è¨‚å–®ç®¡ç†</a>
</div>

<div class="ui segment">
  <!-- ğŸ“¦ ç”¢å“ç®¡ç† -->
  <div *ngIf="selectedSection === 'products'">
    <h3>ğŸ“¦ ç”¢å“ç®¡ç†</h3>
    <button class="ui primary button" (click)="addProduct()">
      â• æ–°å¢ç”¢å“
    </button>

    <!-- ğŸ”½ æ–°å¢ç”¢å“è¡¨å–® -->
    <div class="ui form">
      <div class="fields">
        <div class="field">
          <label>ç”¢å“åç¨±</label>
          <input
            type="text"
            [(ngModel)]="newProduct.name"
            placeholder="ç”¢å“åç¨±"
          />
        </div>

        <!-- é¡åˆ¥é¸æ“‡ -->
        <div class="field">
          <label>é¡åˆ¥</label>
          <select class="ui dropdown" [(ngModel)]="newProduct.category">
            <option value="">è«‹é¸æ“‡é¡åˆ¥</option>
            <option *ngFor="let cat of categories" [value]="cat">
              {{ cat }}
            </option>
          </select>
        </div>

        <div class="field">
          <label>æè¿°</label
          ><input
            type="text"
            [(ngModel)]="newProduct.description"
            placeholder="æè¿°"
          />
        </div>

        <div class="field">
          <label>åƒ¹æ ¼</label
          ><input
            type="number"
            [(ngModel)]="newProduct.price"
            placeholder="åƒ¹æ ¼"
          />
        </div>

        <div class="field">
          <label>åº«å­˜</label
          ><input
            type="number"
            [(ngModel)]="newProduct.stock_quantity"
            placeholder="åº«å­˜"
          />
        </div>

        <!-- åœ–ç‰‡ä¸Šå‚³ï¼Œç•¶ category æ²’é¸æ“‡æ™‚ï¼ŒæŒ‰éˆ•è¢«ç¦ç”¨ -->
        <div class="field">
          <label>ä¸Šå‚³åœ–ç‰‡</label>
          <input
            type="file"
            (change)="onFileSelected($event)"
            [disabled]="!newProduct.category"
          />
          <input
            type="text"
            [(ngModel)]="newProduct.image_url"
            placeholder="åœ–ç‰‡ç¶²å€"
            readonly
          />
        </div>

        <!-- åœ–ç‰‡é è¦½ -->
        <div *ngIf="newProduct.image_url">
          <img
            [src]="newProduct.image_url"
            alt="é è¦½åœ–ç‰‡"
            style="max-width: 100px; max-height: 100px; margin-top: 10px"
          />
        </div>
      </div>
    </div>

    <!-- ğŸ“‚ é¡åˆ¥ç¯©é¸å™¨ -->
    <div class="ui form" style="margin-bottom: 10px">
      <div class="inline fields">
        <label>ğŸ“‚ ç¯©é¸é¡åˆ¥ï¼š</label>
        <select class="ui dropdown" [(ngModel)]="selectedCategoryFilter">
          <option value="">å…¨éƒ¨é¡åˆ¥</option>
          <option *ngFor="let cat of categories" [value]="cat">
            {{ cat }}
          </option>
        </select>
        <button class="ui button" (click)="selectedCategoryFilter = ''">
          ğŸ”„ æ¸…é™¤ç¯©é¸
        </button>
      </div>
    </div>

    <!-- âœ… ç”¢å“åˆ—è¡¨ -->
    <table class="ui celled table">
      <thead>
        <tr>
          <th>ç”¢å“åç¨±</th>
          <th>é¡åˆ¥</th>
          <th>åƒ¹æ ¼</th>
          <th>æè¿°</th>
          <th>åœ–ç‰‡</th>
          <th>åº«å­˜</th>
          <th>æ“ä½œ</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let product of filteredProducts">
          <td>{{ product.name }}</td>
          <td>{{ product.category }}</td>
          <td>{{ product.price }} HKD</td>
          <td>{{ product.description }}</td>
          <td>
            <img
              *ngIf="product.image_url"
              [src]="product.image_url"
              alt="ç”¢å“åœ–ç‰‡"
              style="width: 80px; height: auto"
            />
          </td>
          <td>{{ product.stock_quantity }}</td>
          <td>
            <button class="ui yellow button" (click)="openEditDialog(product)">
              âœï¸ ç·¨è¼¯
            </button>
            <button class="ui red button" (click)="deleteProduct(product.id)">
              ğŸ—‘ï¸ åˆªé™¤
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- ğŸ“œ è¨‚å–®ç®¡ç† -->
  <div *ngIf="selectedSection === 'orders'">
    <h3>ğŸ“œ è¨‚å–®ç®¡ç†</h3>

    <!-- ğŸ”½ é€è²¨æ–¹å¼ç¯©é¸å™¨ -->
    <div class="ui form" style="margin-bottom: 10px">
      <div class="inline fields">
        <label>ğŸšš é€è²¨æ–¹å¼ç¯©é¸ï¼š</label>
        <select class="ui dropdown" [(ngModel)]="selectedDeliveryFilter">
          <option value="">å…¨éƒ¨</option>
          <option value="æ¨™æº–é€è²¨">æ¨™æº–é€è²¨</option>
          <option value="åˆ°åº—è‡ªå–">åˆ°åº—è‡ªå–</option>
        </select>
        <button class="ui button" (click)="selectedDeliveryFilter = ''">
          ğŸ”„ æ¸…é™¤ç¯©é¸
        </button>
      </div>
    </div>

    <table class="ui celled table">
      <thead>
        <tr>
          <th>è¨‚å–® ID</th>
          <th>é¡§å®¢</th>
          <th>ç”¢å“</th>
          <th>æ•¸é‡</th>
          <th>å°ºå¯¸ / ææ•¸</th>
          <th>å–®åƒ¹</th>
          <th>ç¸½é‡‘é¡</th>
          <th>ä»˜æ¬¾æ–¹å¼</th>
          <th>ä»˜æ¬¾ç‹€æ…‹</th>
          <th>æ™‚é–“</th>
          <th>é€è²¨æ–¹å¼</th>
          <th>é€è²¨åœ°å€</th>
          <th>é€è²¨æ—¥æœŸ</th>
          <th>é€è²¨æ™‚é–“</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let order of filteredOrders">
          <td>{{ order.order_id }}</td>
          <td>{{ order.customer }}</td>
          <td>{{ order.product_name }}</td>
          <td>{{ order.quantity }}</td>
          <td>{{ order.size }} / {{ order.stems }} æ</td>
          <td>{{ order.price }} HKD</td>
          <td>{{ order.total_amount }} HKD</td>
          <td>{{ order.payment_method }}</td>
          <td>
            <select
              class="ui dropdown"
              [(ngModel)]="order.status"
              (change)="updateOrderStatus(order)"
            >
              <option value="ç­‰å€™æ ¸å°">ç­‰å€™æ ¸å°</option>
              <option value="å·²ä»˜æ¬¾">å·²ä»˜æ¬¾</option>
              <option value="å·²å®Œæˆ">å·²å®Œæˆ</option>
              <option value="å·²å–æ¶ˆ">å·²å–æ¶ˆ</option>
            </select>
          </td>
          <td>{{ order.created_at }}</td>
          <td>{{ order.delivery_method }}</td>
          <td>{{ order.delivery_district }}/{{ order.delivery_address }}</td>
          <td>{{ order.delivery_date }}</td>
          <td>{{ order.delivery_time }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
